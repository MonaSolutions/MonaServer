<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>API &mdash; MonaServer</title>
    
    <link rel="stylesheet" href="_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootswatch-3.3.6/cerulean/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="_static/my-styles.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  false
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="_static/bootstrap-3.3.6/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="_static/bootstrap-sphinx.js"></script>
    <link rel="top" title="MonaServer" href="index.html" />

  
  <link href='http://fonts.googleapis.com/css?family=Lobster' rel='stylesheet' type='text/css'>
  <link href='http://fonts.googleapis.com/css?family=Cabin' rel='stylesheet' type='text/css'>

  
  <a href="https://github.com/MonaSolutions/MonaServer"
     class="visible-desktop hidden-xs"><img
    id="gh-banner"
    style="position: absolute; top: 50px; right: 0; border: 0;"
    src="_static/githubBlack.png"
    alt="Fork us on GitHub"></a>
  <script>
    // Adjust image position with banner height
    $(function () {
      var navHeight = $(".navbar .container").css("height");
      $("#gh-banner").css("top", navHeight);
    });
  </script>
  
  
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  
    ga('create', 'UA-58143950-1', 'auto');
    ga('send', 'pageview');
  
  </script>
  
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">


  </head>
  <body role="document">
    <div id="content">
    

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="index.html">
          MonaServer</a>
        <span class="navbar-text navbar-version pull-left"><b>1</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="quickstart.html"><img src="_static/star-bookmark-icone-8571-48.png"/> Quick Start</a></li>
                <li><a href="faq.html"><img src="_static/aide-point-interrogation-systeme-icone-8289-48.png"/> FAQ</a></li>
                <li><a href="contacts.html"><img src="_static/casque-ecoute-soutien-icone-9816-48.png"/> Services</a></li>
                <li><a href="roadmap.html"><img src="_static/time-system-preferences-icone-8704-48.png"/> Roadmap</a></li>
                <li><a href="manual.html"><img src="_static/texinfo-texte-x-icone-4685-48.png"/> Documentation</a></li>
            
            


            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    
    
    

    <div class="col-md-12 content">
      
  <div class="section" id="api">
<h1><a class="toc-backref" href="#id32">API</a><a class="headerlink" href="#api" title="Permalink to this headline">¶</a></h1>
<p>This page references objects and events availables in a <a class="reference internal" href="serverapp.html"><span class="doc">Server Application</span></a> of MonaServer.</p>
<div class="contents topic" id="table-of-contents">
<p class="topic-title first">Table of Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#api" id="id32">API</a><ul>
<li><a class="reference internal" href="#objects" id="id33">Objects</a><ul>
<li><a class="reference internal" href="#common-notions" id="id34">Common notions</a></li>
<li><a class="reference internal" href="#application-properties" id="id35">Application properties</a></li>
<li><a class="reference internal" href="#mona" id="id36">Mona</a></li>
<li><a class="reference internal" href="#data" id="id37">Data</a></li>
<li><a class="reference internal" href="#clients" id="id38">Clients</a></li>
<li><a class="reference internal" href="#client" id="id39">Client</a></li>
<li><a class="reference internal" href="#writer" id="id40">Writer</a></li>
<li><a class="reference internal" href="#groups" id="id41">Groups</a></li>
<li><a class="reference internal" href="#group" id="id42">Group</a></li>
<li><a class="reference internal" href="#member" id="id43">Member</a></li>
<li><a class="reference internal" href="#qualityofservice" id="id44">QualityOfService</a></li>
<li><a class="reference internal" href="#publications" id="id45">Publications</a></li>
<li><a class="reference internal" href="#publication" id="id46">Publication</a></li>
<li><a class="reference internal" href="#listeners" id="id47">Listeners</a></li>
<li><a class="reference internal" href="#listener" id="id48">Listener</a></li>
<li><a class="reference internal" href="#bytereader" id="id49">ByteReader</a></li>
<li><a class="reference internal" href="#bytewriter" id="id50">ByteWriter</a></li>
<li><a class="reference internal" href="#servers" id="id51">Servers</a></li>
<li><a class="reference internal" href="#server" id="id52">Server</a></li>
<li><a class="reference internal" href="#broadcaster" id="id53">Broadcaster</a></li>
<li><a class="reference internal" href="#file" id="id54">File</a></li>
<li><a class="reference internal" href="#ipaddress" id="id55">IPAddress</a></li>
<li><a class="reference internal" href="#socketaddress" id="id56">SocketAddress</a></li>
</ul>
</li>
<li><a class="reference internal" href="#ref-events" id="id57">Events</a><ul>
<li><a class="reference internal" href="#id31" id="id58">Common notions</a></li>
<li><a class="reference internal" href="#onstart-path" id="id59">onStart(path)</a></li>
<li><a class="reference internal" href="#onstop-path" id="id60">onStop(path)</a></li>
<li><a class="reference internal" href="#onconnection-client" id="id61">onConnection(client,...)</a></li>
<li><a class="reference internal" href="#ondisconnection-client" id="id62">onDisconnection(client)</a></li>
<li><a class="reference internal" href="#onmanage" id="id63">onManage()</a></li>
<li><a class="reference internal" href="#onrendezvousunknown-protocol-peerid" id="id64">onRendezVousUnknown(protocol, peerId)</a></li>
<li><a class="reference internal" href="#onhandshake-address-path-properties-attempts" id="id65">onHandshake(address,path,properties,attempts)</a></li>
<li><a class="reference internal" href="#onserverconnection-server" id="id66">onServerConnection(server)</a></li>
<li><a class="reference internal" href="#onserverdisconnection-server" id="id67">onServerDisconnection(server)</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="objects">
<h2><a class="toc-backref" href="#id33">Objects</a><a class="headerlink" href="#objects" title="Permalink to this headline">¶</a></h2>
<div class="section" id="common-notions">
<h3><a class="toc-backref" href="#id34">Common notions</a><a class="headerlink" href="#common-notions" title="Permalink to this headline">¶</a></h3>
<p>Some notions are common for all available objects.</p>
<div class="section" id="properties">
<h4>Properties<a class="headerlink" href="#properties" title="Permalink to this headline">¶</a></h4>
<p>A property is available as follows:</p>
<div class="highlight-lua"><div class="highlight"><pre><span></span><span class="n">value</span> <span class="o">=</span> <span class="n">object</span><span class="p">.</span><span class="n">property</span>
</pre></div>
</div>
<p>And it can be assigned if it&#8217;s not a <em>read-only</em> property like that:</p>
<div class="highlight-lua"><div class="highlight"><pre><span></span><span class="n">object</span><span class="p">.</span><span class="n">property</span> <span class="o">=</span> <span class="n">value</span>
</pre></div>
</div>
</div>
<div class="section" id="methods">
<h4>methods<a class="headerlink" href="#methods" title="Permalink to this headline">¶</a></h4>
<p>A method is called as follows:</p>
<div class="highlight-lua"><div class="highlight"><pre><span></span><span class="n">results</span> <span class="o">=</span> <span class="n">object</span><span class="p">:</span><span class="n">method</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span>
</pre></div>
</div>
<p>It can take multiple parameters and return mutiple results.</p>
</div>
<div class="section" id="events">
<h4>events<a class="headerlink" href="#events" title="Permalink to this headline">¶</a></h4>
<p>A few objects have also some events called by the system. Simply overload the named event by defining a function as follows:</p>
<div class="highlight-lua"><div class="highlight"><pre><span></span><span class="k">function</span> <span class="nf">object</span><span class="p">:</span><span class="n">onManage</span><span class="p">()</span>
  <span class="n">self</span><span class="p">:</span><span class="n">writeInvocation</span><span class="p">(</span><span class="s2">&quot;</span><span class="s">push&quot;</span><span class="p">,</span><span class="s2">&quot;</span><span class="s">test&quot;</span><span class="p">)</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="section" id="pairs-and-ipairs">
<h4>pairs and ipairs<a class="headerlink" href="#pairs-and-ipairs" title="Permalink to this headline">¶</a></h4>
<p>Objects are kind of array or map, so you can iterate between elements of objects as follows:</p>
<div class="highlight-lua"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">index</span><span class="p">,</span><span class="n">value</span> <span class="k">in</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">object</span><span class="p">)</span> <span class="k">do</span>
  <span class="n">INFO</span><span class="p">(</span><span class="n">index</span><span class="p">,</span><span class="n">value</span><span class="p">)</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="application-properties">
<h3><a class="toc-backref" href="#id35">Application properties</a><a class="headerlink" href="#application-properties" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><strong>name</strong> (read-only), the name of the application.</li>
<li><strong>path</strong> (read-only), the path of the current application.</li>
<li><strong>this</strong> (read-only), the current application&#8217;s object.</li>
<li><strong>super</strong> (read-only), an object giving acces to members and functions of the parent application.</li>
<li><strong>children</strong> (read-only), an associative array containing children applications as values and their names as keys (only already loaded children are availables).</li>
</ul>
<p>See <a class="reference internal" href="serverapp.html"><span class="doc">Server Application</span></a> to have more information of communication between applications.</p>
</div>
<div class="section" id="mona">
<span id="ref-mona"></span><h3><a class="toc-backref" href="#id36">Mona</a><a class="headerlink" href="#mona" title="Permalink to this headline">¶</a></h3>
<p><em>mona</em> is a global object providing access to main Mona elements, available anywhere in all script files.</p>
<div class="section" id="id1">
<h4>properties<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><strong>clients</strong> (read-only), <a class="reference internal" href="#clients">Clients</a> actually connected.</li>
<li><strong>configs</strong> (read-only), return a <a class="reference external" href="http://www.lua.org/">LUA</a> table which contains Mona configurations, it means the <em>MonaServer.ini</em> content file, (see <a class="reference internal" href="installation.html#ref-configurations"><span class="std std-ref">Configurations</span></a>) and also some others usefull parameters (application.path, application.baseName, and many others. To know really all its content, iterate on this table and print its content). One sample is given in <a class="reference internal" href="serverapp.html#ref-global-configurations"><span class="std std-ref">Global configurations</span></a>.</li>
<li><strong>environment</strong> (read-only), return a <a class="reference external" href="http://www.lua.org/">LUA</a> table which contains environment variables from the system.</li>
<li><strong>groups</strong> (read-only), existing <a class="reference internal" href="#groups">Groups</a> (<a class="reference external" href="http://help.adobe.com/en_US/FlashPlatform/reference/actionscript/3/flash/net/NetGroup.html">NetGroup</a> running).</li>
<li><strong>pulications</strong> (read-only), server <a class="reference internal" href="#publications">Publications</a> available.</li>
<li><strong>servers</strong> (read-only), MonaServer instances actually connected to the server, see <a class="reference internal" href="#servers">Servers</a> object.</li>
</ul>
<p>Example of access to a Mona global property :</p>
<div class="highlight-lua"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">id</span><span class="p">,</span> <span class="n">client</span> <span class="k">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">mona</span><span class="p">.</span><span class="n">clients</span><span class="p">)</span> <span class="k">do</span>
  <span class="n">INFO</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="s2">&quot;</span><span class="s"> : &quot;</span><span class="p">,</span> <span class="n">client</span><span class="p">.</span><span class="n">address</span><span class="p">)</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="section" id="id2">
<h4>methods<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><strong>absolutePath(path)</strong>, take in first parameter the application <em>path</em> and returns a absolute way for its folder. Helpful to separate the code of your server application in many <a class="reference external" href="http://www.lua.org/">LUA</a> files (see <a class="reference internal" href="serverapp.html#ref-lua-extensions"><span class="std std-ref">LUA extensions and files inclusion</span></a>).</li>
<li><strong>addToBlacklist(...)</strong>, add to the blacklist the address(es) ip given as input argument(s).</li>
<li><strong>removeFromBlacklist(...)</strong>, remove from the blacklist the address(es) ip given as input argument(s).</li>
<li><strong>createIPAddress(address)</strong>, convert an IP Address string to an <a class="reference internal" href="#ipaddress">IPAddress</a> object without DNS resolution (not blocking method).</li>
<li><strong>createIPAddressWithDNS(address)</strong>, convert an IP Address string to an <a class="reference internal" href="#ipaddress">IPAddress</a> object with DNS resolution (blocking method).</li>
<li><strong>createSocketAddress(address)</strong>, convert a Socket Address string (with host and port) to a <a class="reference internal" href="#socketaddress">SocketAddress</a> object without DNS resolution (not blocking method).</li>
<li><strong>createSocketAddressWithDNS(address)</strong>, convert a Socket Address string (with host and port) to a <a class="reference internal" href="#socketaddress">SocketAddress</a> object with DNS resolution (blocking method).</li>
<li><strong>createTCPClient()</strong>, return a TCP client, see <a class="reference internal" href="serversocket.html"><span class="doc">Server Application Sockets</span></a> page for more details.</li>
<li><strong>createTCPServer()</strong>, return a TCP server, see <a class="reference internal" href="serversocket.html"><span class="doc">Server Application Sockets</span></a> page for more details.</li>
<li><strong>createUDPSocket([allowBroadcast])</strong>, return a UDP socket. The optional boolean <em>allowBroadcast</em> argument allows broadcasting date by this socket (by default it&#8217;s to <em>false</em>). See <a class="reference internal" href="serversocket.html"><span class="doc">Server Application Sockets</span></a> page for more details.</li>
<li><strong>publish(name)</strong>, publishs a server publication with the name given, this method returns a <a class="reference internal" href="#publication">Publication</a> object if successful, or <em>nil</em> otherwise. Indeed it can fail if a publication with the same name exists already. Read <a class="reference internal" href="#publication">Publication</a> object thereafter to get more details on how push audio,video or data packet for this publication.</li>
<li><strong>fromAMF(data)</strong>, convert the AMF data given in parameter in multiple <a class="reference external" href="http://www.lua.org/">LUA</a> types relating (see <a class="reference internal" href="serverapp.html#ref-amf-to-lua"><span class="std std-ref">AMF to LUA conversions</span></a> to know how AMF/<a class="reference external" href="http://www.lua.org/">LUA</a> conversion works). It returns multiple <a class="reference external" href="http://www.lua.org/">LUA</a> data variables.</li>
<li><strong>toAMF(...)</strong>, convert the multiple <a class="reference external" href="http://www.lua.org/">LUA</a> parameters given in a AMF format (see <a class="reference internal" href="serverapp.html#ref-amf-to-lua"><span class="std std-ref">AMF to LUA conversions</span></a> to know how AMF/<a class="reference external" href="http://www.lua.org/">LUA</a> conversion works). It returns a string which contain data converted.</li>
<li><strong>toAMF0(...)</strong>, exactly same that the precedent method, but with a conversion priority to AMF0 format (when possible).</li>
<li><strong>fromJSON(data)</strong>, convert the JSON data given in parameter in multiple <a class="reference external" href="http://www.lua.org/">LUA</a> types relating (see <a class="reference internal" href="serverapp.html#ref-json-to-lua"><span class="std std-ref">JSON to LUA conversions</span></a> to know how JSON/<a class="reference external" href="http://www.lua.org/">LUA</a> conversion works). It returns multiple <a class="reference external" href="http://www.lua.org/">LUA</a> data variables.</li>
<li><strong>toJSON(...)</strong>, convert the multiple <a class="reference external" href="http://www.lua.org/">LUA</a> parameters given in a JSON format (see <a class="reference internal" href="serverapp.html#ref-json-to-lua"><span class="std std-ref">JSON to LUA conversions</span></a> to know how Query/<a class="reference external" href="http://www.lua.org/">LUA</a> conversion works). It returns a string which contain data converted.</li>
<li><strong>fromQuery(data)</strong>, convert the <a class="reference external" href="http://en.wikipedia.org/wiki/Query_string">Query string</a> data given in parameter in multiple <a class="reference external" href="http://www.lua.org/">LUA</a> types relating (see <a class="reference internal" href="serverapp.html#ref-json-to-lua"><span class="std std-ref">JSON to LUA conversions</span></a> to know how Query/<a class="reference external" href="http://www.lua.org/">LUA</a> conversion works). It returns multiple <a class="reference external" href="http://www.lua.org/">LUA</a> data variables.</li>
<li><strong>toQuery(...)</strong>, convert the multiple <a class="reference external" href="http://www.lua.org/">LUA</a> parameters given in a <a class="reference external" href="http://en.wikipedia.org/wiki/Query_string">Query string</a> format (see <a class="reference internal" href="serverapp.html#ref-json-to-lua"><span class="std std-ref">JSON to LUA conversions</span></a> to know how JSON/<a class="reference external" href="http://www.lua.org/">LUA</a> conversion works). It returns a string which contain data converted.</li>
<li><strong>fromXML(data)</strong>, convert the XML data given in parameter in multiple <a class="reference external" href="http://www.lua.org/">LUA</a> types relating (see <a class="reference internal" href="serverapp.html#ref-xml-compatibility"><span class="std std-ref">XML data compatibility (XML parser)</span></a> to know how XML/<a class="reference external" href="http://www.lua.org/">LUA</a> conversion works). It returns multiple <a class="reference external" href="http://www.lua.org/">LUA</a> data variables.</li>
<li><strong>toXML(...)</strong>, convert the multiple <a class="reference external" href="http://www.lua.org/">LUA</a> parameters given in a XML format (see <a class="reference internal" href="serverapp.html#ref-xml-compatibility"><span class="std std-ref">XML data compatibility (XML parser)</span></a> to know how XML/<a class="reference external" href="http://www.lua.org/">LUA</a> conversion works). It returns a string which contain data converted.</li>
<li><strong>fromXMLRPC(data)</strong>, convert the <a class="reference external" href="http://xmlrpc.scripting.com/spec.html">XML-RPC</a> data given in parameter in multiple <a class="reference external" href="http://www.lua.org/">LUA</a> types relating (see <a class="reference internal" href="serverapp.html#ref-xmlrpc-to-lua"><span class="std std-ref">XML-RPC to LUA conversions</span></a> to know how XMLRPC/<a class="reference external" href="http://www.lua.org/">LUA</a> conversion works). It returns multiple <a class="reference external" href="http://www.lua.org/">LUA</a> data variables.</li>
<li><strong>toXMLRPC(...)</strong>, convert the multiple <a class="reference external" href="http://www.lua.org/">LUA</a> parameters given in a <a class="reference external" href="http://xmlrpc.scripting.com/spec.html">XML-RPC</a> format (see <a class="reference internal" href="serverapp.html#ref-xmlrpc-to-lua"><span class="std std-ref">XML-RPC to LUA conversions</span></a> to know how XMLRPC/<a class="reference external" href="http://www.lua.org/">LUA</a> conversion works). It returns a string which contain data converted.</li>
<li><strong>md5(...)</strong>, computes and returns the MD5 values from input values given as arguments.</li>
<li><strong>sha256(...)</strong>, computes and returns the SHA256 values from input values given as arguments.</li>
<li><strong>split(expression,separator[,option])</strong>, <a class="reference external" href="http://www.lua.org/">LUA</a> has not real split operator, this function fills this gap. It splits the <em>expression</em> in relation with the <em>separator</em> term given, and returns tokens as a multiple result. A optional number argument indicates if you want to ignore empty tokens (<em>option</em> =1), or to remove leading and trailing whitespace from tokens (<em>option</em> =2), or the both in same time (<em>option</em> =3).</li>
<li><strong>listPaths(dirName)</strong>, return a <a class="reference external" href="http://www.lua.org/">LUA</a> table containing objects of type <a class="reference internal" href="#file">File</a> in the <em>dirName</em> directory (relative to the <strong>www</strong> path).</li>
<li><strong>joinGroup(peerID, groupID)</strong>, add <a class="reference internal" href="#client">Client</a> with <em>peerID</em> to <a class="reference internal" href="#group">Group</a> with <em>groupID</em>.</li>
<li><strong>time()</strong>, gives the epoch time (since the Unix epoch, midnight, January 1, 1970) in milliseconds.</li>
<li><strong>dump(data[, size])</strong>, dump data to the console and log file, if <em>size</em> is not specified it dump all the data.</li>
</ul>
<p>Example of access to a Mona global function :</p>
<div class="highlight-lua"><div class="highlight"><pre><span></span><span class="o">#</span> <span class="n">Print</span> <span class="n">congiguration</span> <span class="n">array</span> <span class="k">in</span> <span class="n">a</span> <span class="n">JSON</span> <span class="n">format</span>
<span class="n">INFO</span><span class="p">(</span><span class="n">mona</span><span class="p">:</span><span class="n">toJSON</span><span class="p">(</span><span class="n">mona</span><span class="p">.</span><span class="n">configs</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="data">
<h3><a class="toc-backref" href="#id37">Data</a><a class="headerlink" href="#data" title="Permalink to this headline">¶</a></h3>
<p><strong>data</strong> is the global variable that permits you to have persistent values, see <a class="reference internal" href="database.html"><span class="doc">The NoSQL Cache System</span></a> page to know how to use it.</p>
</div>
<div class="section" id="clients">
<h3><a class="toc-backref" href="#id38">Clients</a><a class="headerlink" href="#clients" title="Permalink to this headline">¶</a></h3>
<p><em>clients</em> object (available by <em>mona.clients</em> way, see <a class="reference internal" href="#mona">Mona</a> object) is the collection of clients currently connected to the server.</p>
<div class="section" id="id3">
<h4>methods<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><strong>(id/rawId)</strong>, return a <a class="reference internal" href="#client">Client</a> object, it can take the id client parameter in a <em>string</em> format or a <em>raw hex</em> format.</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>You can use the <strong>pairs()</strong> <a class="reference external" href="http://www.lua.org/">LUA</a> function to iterate on the list of <em>clients</em>, keys are <em>client.id</em> and values are <a class="reference internal" href="#client">Client</a> objects.</li>
<li>And the &#8220;#&#8221; operator to get the number of clients.</li>
</ul>
</div>
</div>
</div>
<div class="section" id="client">
<span id="ref-client"></span><h3><a class="toc-backref" href="#id39">Client</a><a class="headerlink" href="#client" title="Permalink to this headline">¶</a></h3>
<p><em>client</em> object describes a connected client.</p>
<div class="section" id="id4">
<h4>properties<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><strong>id</strong> (read-only), the client id in a readable string format, it has a size of 64 bytes.</li>
<li><strong>rawId</strong> (read-only), the client id in a hexadecimal raw format, it has a size of 32 bytes.</li>
<li><strong>address</strong> (read-only), address of the client.</li>
<li><strong>path</strong> (read-only), <em>path</em> used in the URL connection, it gives server application related (see <a class="reference internal" href="serverapp.html"><span class="doc">Server Application</span></a>).</li>
<li><strong>ping</strong> (read-only), client ping value.</li>
<li><strong>lastReceptionTime</strong> (read-only), time of last data reception.</li>
<li><strong>protocol</strong> (read-only), client protocol name (HTTP, WebSocket, RTMP or RTMFP).</li>
<li><strong>query</strong> (read-only), query part of the url (used in HTTP).</li>
<li><strong>writer</strong> (read-only), the main <a class="reference internal" href="#writer">Writer</a> to communicate with the client.</li>
<li><strong>properties</strong> (read-only), dynamic properties of the client connection, depends on the protocol (see <a class="reference internal" href="protocols.html"><span class="doc">Specific Protocol Features</span></a>).</li>
<li><strong>parameters</strong> (read-only), static parameters/configuration of the client protocol (<strong>parameters</strong> can be substituate by protocol name).</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>You can use the <strong>pairs()</strong> <a class="reference external" href="http://www.lua.org/">LUA</a> function to iterate on the lists <em>client.properties</em> and <em>client.parameters</em>.</li>
<li>And the &#8220;#&#8221; operator to get the number of properties/parameters.</li>
</ul>
</div>
<p>In <em>client.properties</em> the word <em>properties</em> can be omitted to access directly to client&#8217;s attributes. Here is a sample with an RTMFP connection :</p>
<div class="highlight-as3"><div class="highlight"><pre><span></span><span class="n">_netConnection</span><span class="o">.</span><span class="na">connect</span><span class="o">(</span><span class="s2">&quot;rtmfp://localhost/myApplication?arg1=value1&amp;arg2=value2&quot;</span><span class="o">);</span>
</pre></div>
</div>
<div class="highlight-lua"><div class="highlight"><pre><span></span><span class="k">function</span> <span class="nf">onConnection</span><span class="p">(</span><span class="n">client</span><span class="p">,</span><span class="o">...</span><span class="p">)</span>
  <span class="n">NOTE</span><span class="p">(</span><span class="s2">&quot;</span><span class="s">client arg1 = &quot;</span><span class="o">..</span><span class="n">client</span><span class="p">.</span><span class="n">arg1</span><span class="p">)</span>
  <span class="n">NOTE</span><span class="p">(</span><span class="s2">&quot;</span><span class="s">client arg2 = &quot;</span><span class="o">..</span><span class="n">client</span><span class="p">.</span><span class="n">arg2</span><span class="p">)</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="section" id="id5">
<h4>methods<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h4>
<p><em>client</em> has no hard-coded method by default, and if you add some methods on, you create RPC function available from client side (see <a class="reference internal" href="serverapp.html#ref-com-server-client"><span class="std std-ref">Communication between server and client</span></a> for more details).</p>
</div>
<div class="section" id="id6">
<h4>events<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><strong>onAddressChanged(oldAddress)</strong>, happen on client.address change (can happen for an UDP based protocol like RTMFP).</li>
<li><strong>onJoinGroup(group)</strong>, happen when the client join a P2P <a class="reference internal" href="#group">Group</a> (RTMFP - NetGroup).</li>
<li><strong>onUnjoinGroup(group)</strong>, happen when the client leaves a P2P <a class="reference internal" href="#group">Group</a> (RTMFP - NetGroup).</li>
<li><strong>onPublish(publication)</strong>, happen on <a class="reference internal" href="#publication">Publication</a> starts.</li>
</ul>
<p>If you return <em>false</em> value on this event, it will send a <em>NetStream.Publish.Failed</em> status event with as <em>info.description</em> field a <em>&#8220;Not allowed to publish [name]&#8221;</em> message.
Otherwise you can cutomize this message in raising one error in this context.</p>
<div class="highlight-lua"><div class="highlight"><pre><span></span><span class="k">function</span> <span class="nf">client</span><span class="p">:</span><span class="n">onPublish</span><span class="p">(</span><span class="n">publication</span><span class="p">)</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="n">client</span><span class="p">.</span><span class="n">right</span> <span class="k">then</span>
    <span class="nb">error</span><span class="p">(</span><span class="s2">&quot;</span><span class="s">no rights to publish it&quot;</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="k">function</span> <span class="nf">publication</span><span class="p">:</span><span class="n">onData</span><span class="p">(</span><span class="n">time</span><span class="p">,</span><span class="n">packet</span><span class="p">)</span>
    <span class="c1">-- write code here</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
<div class="highlight-as3"><div class="highlight"><pre><span></span><span class="kd">function </span><span class="nf">onStatusEvent</span><span class="o">(</span><span class="n">event</span><span class="o">:</span><span class="kt">NetStatusEvent</span><span class="o">):</span><span class="kt">void</span> <span class="o">{</span>
  <span class="k">switch</span><span class="o">(</span><span class="n">event</span><span class="o">.</span><span class="na">info</span><span class="o">.</span><span class="na">code</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">case</span> <span class="s2">&quot;NetStream.Publish.Failed&quot;</span><span class="o">:</span>
    <span class="nf">trace</span><span class="o">(</span><span class="n">event</span><span class="o">.</span><span class="na">info</span><span class="o">.</span><span class="na">description</span><span class="o">);</span> <span class="c1">// displays &quot;no rights to publish it&quot;</span>
    <span class="k">break</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">This event is not called for publications started from script code, it&#8217;s called only for client publications (see <a class="reference internal" href="#publication">Publication</a> object). Then of course, it&#8217;s called only in stream-to-server case (not in P2P case).</p>
</div>
<ul class="simple">
<li><strong>onUnpublish(publication)</strong>, happen on <a class="reference internal" href="#publication">Publication</a> stops.</li>
</ul>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">This event is not called for publications started from script code, it&#8217;s called only for client publications (see <a class="reference internal" href="#publication">Publication</a> object). Then of course, it&#8217;s called only in stream-to-server case (not in P2P case).</p>
</div>
<ul class="simple">
<li><strong>onSubscribe(listener)</strong>, happen on publication subscription, <a class="reference internal" href="#listener">Listener</a> argument describes this subscription.</li>
</ul>
<p>If you return <em>false</em> value on this event, it will send a <em>NetStream.Play.Failed</em> status event with as <em>info.description</em> field a <em>&#8220;Not authorized to play [name]&#8221;</em> message.
Otherwise you can cutomize this message in raising one error in this context.</p>
<div class="highlight-lua"><div class="highlight"><pre><span></span><span class="k">function</span> <span class="nf">client</span><span class="p">:</span><span class="n">onSubscribe</span><span class="p">(</span><span class="n">listener</span><span class="p">)</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="n">client</span><span class="p">.</span><span class="n">right</span> <span class="k">then</span>
    <span class="nb">error</span><span class="p">(</span><span class="s2">&quot;</span><span class="s">no rights to play it&quot;</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
<div class="highlight-as3"><div class="highlight"><pre><span></span><span class="kd">function </span><span class="nf">onStatusEvent</span><span class="o">(</span><span class="n">event</span><span class="o">:</span><span class="kt">NetStatusEvent</span><span class="o">):</span><span class="kt">void</span> <span class="o">{</span>
  <span class="k">switch</span><span class="o">(</span><span class="n">event</span><span class="o">.</span><span class="na">info</span><span class="o">.</span><span class="na">code</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">case</span> <span class="s2">&quot;NetStream.Play.Failed&quot;</span><span class="o">:</span>
    <span class="nf">trace</span><span class="o">(</span><span class="n">event</span><span class="o">.</span><span class="na">info</span><span class="o">.</span><span class="na">description</span><span class="o">);</span> <span class="c1">// displays &quot;no rights to play it&quot;</span>
    <span class="k">break</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">This event is called only in stream-to-server case (not in P2P case).</p>
</div>
<ul class="simple">
<li><strong>onUnsubscribe(listener)</strong>, happen on publication unsubscription, <a class="reference internal" href="#listener">Listener</a> argument describes the abandoned subscription.</li>
</ul>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">This event is called only in stream-to-server case (not in P2P case).</p>
</div>
<ul class="simple">
<li><strong>onRead(file,parameters...)</strong></li>
</ul>
<p>This event is used with <strong>HTTP</strong> protocol.</p>
<p>Called when a client try to read a file on the server. The file should exists.
Parameters should be used to perform REST functionnalities.</p>
<p>You can also reject the connexion like this :</p>
<div class="highlight-lua"><div class="highlight"><pre><span></span><span class="k">function</span> <span class="nf">client</span><span class="p">:</span><span class="n">onRead</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">file</span> <span class="o">~=</span> <span class="s2">&quot;</span><span class="s">index.html&quot;</span> <span class="k">then</span>
    <span class="nb">error</span><span class="p">(</span><span class="s2">&quot;</span><span class="s">Access to file is forbidden)</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
<p>You can redirect to another file returning the file name as first parameter :</p>
<div class="highlight-lua"><div class="highlight"><pre><span></span><span class="k">function</span> <span class="nf">client</span><span class="p">:</span><span class="n">onRead</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
  <span class="k">return</span> <span class="s2">&quot;</span><span class="s">newFile&quot;</span>
<span class="k">end</span>
</pre></div>
</div>
<p>Other parameters are treated as values for replacing templates <em>&lt;% property %&gt;</em> in file. So with the script below each <em>&lt;% name %&gt;</em> element will be replaced by &#8220;robert&#8221; :</p>
<div class="highlight-lua"><div class="highlight"><pre><span></span><span class="k">function</span> <span class="nf">client</span><span class="p">:</span><span class="n">onRead</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">file</span><span class="p">,</span> <span class="p">{</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;</span><span class="s">robert&quot;</span><span class="p">}</span>
<span class="k">end</span>
</pre></div>
</div>
<p>If you need to return a custom response you can return <em>nil</em> and write you response using the writer as below:</p>
<div class="highlight-lua"><div class="highlight"><pre><span></span><span class="k">function</span> <span class="nf">client</span><span class="p">:</span><span class="n">onRead</span><span class="p">(</span><span class="n">file</span><span class="p">,</span><span class="n">parameters</span><span class="p">)</span>
  <span class="n">self</span><span class="p">.</span><span class="n">writer</span><span class="p">:</span><span class="n">writeRaw</span><span class="p">(</span><span class="s2">&quot;</span><span class="s">hello&quot;</span><span class="p">);</span> <span class="c1">-- my custom response</span>
  <span class="k">return</span> <span class="kc">nil</span>
<span class="k">end</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You can create your own events on client object to create RPC server methods. These methods will be accessible from client side. By default if you send data to server from client without given a method name, the method invoked is <em>client:onMessage</em>. See <a class="reference internal" href="serverapp.html#ref-com-server-apps"><span class="std std-ref">Communication between server applications</span></a> for more details.</p>
</div>
</div>
</div>
<div class="section" id="writer">
<span id="ref-writer"></span><h3><a class="toc-backref" href="#id40">Writer</a><a class="headerlink" href="#writer" title="Permalink to this headline">¶</a></h3>
<p>A Writer is an unidirectional communication pipe, which allows to write message in a fifo to the client. Each writer is independant and have its own statistic exchange informations. It&#8217;s used to communicate with the client, see <a class="reference internal" href="serverapp.html#ref-com-server-client"><span class="std std-ref">Communication between server and client</span></a> to get more details. Each <a class="reference internal" href="#client">Client</a> have at least one <a class="reference internal" href="#writer">Writer</a> opened (available by <em>client.writer</em>), it&#8217;s its main communication channel, but you can open many writers if need.</p>
<div class="section" id="id7">
<h4>properties<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><strong>reliable</strong>, boolean to make communication server to client reliable or not. In a no-reliable case, the packet can be lost but are transfered more faster than in a reliable case. By default <em>reliable=true</em>.</li>
</ul>
<div class="highlight-lua"><div class="highlight"><pre><span></span><span class="k">function</span> <span class="nf">onConnection</span><span class="p">(</span><span class="n">client</span><span class="p">,</span><span class="o">...</span><span class="p">)</span>
  <span class="n">client</span><span class="p">.</span><span class="n">writer</span><span class="p">.</span><span class="n">reliable</span> <span class="o">=</span> <span class="kc">false</span>
  <span class="n">client</span><span class="p">.</span><span class="n">writer</span><span class="p">.</span><span class="n">writeInvocation</span><span class="p">(</span><span class="s2">&quot;</span><span class="s">method&quot;</span><span class="p">,</span><span class="s2">&quot;</span><span class="s">hello&quot;</span><span class="p">)</span>  <span class="c1">-- packet more fast but can be lost</span>
  <span class="n">client</span><span class="p">.</span><span class="n">writer</span><span class="p">.</span><span class="n">reliable</span> <span class="o">=</span> <span class="kc">true</span>
<span class="k">end</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">About client to server communication this property is set on client side.</p>
</div>
<div class="highlight-as3"><div class="highlight"><pre><span></span><span class="n">_netStream</span><span class="o">.</span><span class="na">dataReliable</span> <span class="o">=</span> <span class="kc">false</span>
<span class="n">_netStream</span><span class="o">.</span><span class="na">send</span><span class="o">(</span><span class="s2">&quot;method&quot;</span><span class="o">,</span><span class="s2">&quot;hello&quot;</span><span class="o">)</span> <span class="o">--</span> <span class="n">packet</span> <span class="n">more</span> <span class="n">fast</span> <span class="n">but</span> <span class="n">can</span> <span class="n">be</span> <span class="n">lost</span>
</pre></div>
</div>
<p>About stream publication it&#8217;s done like that:</p>
<div class="highlight-as3"><div class="highlight"><pre><span></span><span class="n">_netStream</span><span class="o">.</span><span class="na">audioReliable</span> <span class="o">=</span> <span class="kc">false</span>
<span class="n">_netStream</span><span class="o">.</span><span class="na">videoReliable</span> <span class="o">=</span> <span class="kc">false</span>
<span class="n">_netStream</span><span class="o">.</span><span class="na">publish</span><span class="o">(</span><span class="s2">&quot;mystream&quot;</span><span class="o">)</span>
</pre></div>
</div>
<p>And  about stream subscription you opt for a no-reliable mode like that:</p>
<div class="highlight-as3"><div class="highlight"><pre><span></span><span class="n">_netStream</span><span class="o">.</span><span class="na">play</span><span class="o">(</span><span class="s2">&quot;mystream&quot;</span><span class="o">,-</span><span class="mi">3</span><span class="o">)</span>
</pre></div>
</div>
<p>Here the server will stream in a no-reliable way and without buffering, it can improve significantly performances and better cope with congestion.</p>
</div>
<div class="section" id="id8">
<h4>methods<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><strong>writeRaw(...)</strong>, write a result for an invocation client call, it takes multiple <a class="reference external" href="http://www.lua.org/">LUA</a> variables as argument to convert it to AMF and send it to the client (see <a class="reference internal" href="serverapp.html#ref-amf-to-lua"><span class="std std-ref">AMF to LUA conversions</span></a> to know how AMF/<a class="reference external" href="http://www.lua.org/">LUA</a> conversion works).</li>
<li><strong>writeMessage(...)</strong>, write a result for an invocation client call, it takes multiple <a class="reference external" href="http://www.lua.org/">LUA</a> variables as argument to convert it to the output format and send it to the client (see <a class="reference internal" href="serverapp.html#ref-amf-to-lua"><span class="std std-ref">AMF to LUA conversions</span></a> to know how AMF/<a class="reference external" href="http://www.lua.org/">LUA</a> conversion works).</li>
<li><strong>writeInvocation(name,...)</strong>, invoke a client method on client side. First parameter is the name of the function to call, and then it takes multiple <a class="reference external" href="http://www.lua.org/">LUA</a> variables as argument to convert it to AMF and send it to the client (see <a class="reference internal" href="serverapp.html#ref-amf-to-lua"><span class="std std-ref">AMF to LUA conversions</span></a> to know how AMF/<a class="reference external" href="http://www.lua.org/">LUA</a> conversion works).</li>
<li><strong>writeStatusResponse(code,[description])</strong>, call a status event on flash side. If code argument is <em>Call.Failed</em> for example the status event created will be <em>NetConnection.Call.Failed</em>. The second optional argument is the literal description of this event.</li>
<li><strong>flush([full])</strong>, fill queueing data to sending buffer to the pipe without waiting anymore. Helpful in some special real-time sending case with an important flow rate, to control sending. By default the sending is complete and immediate (<em>full=true</em>), however if the optional <em>full</em> argument equals <em>false</em> it sends only the UDP packets where no more data can be written (maximum size reached), but keep the last writing suspended. It can be usefull when you use several writers, and that you want flush their data with a certain order: you call <em>flush(false)</em> on all the writers, and to finish a <em>flush()</em> final to send last suspended data.</li>
<li><strong>newWriter()</strong>, create a new writer communication pipe and returns it.</li>
<li><strong>close()</strong>, close the communication pipe. In the case where you close a writer creating by yourself (in calling <em>client.writer:newWriter()</em>), it closes the writer and you must not use anymore the writer object which is going to be deleted. In the case where you close the main writer of its client (<em>client.writer:close()</em>) it closes the entiere client session.</li>
</ul>
</div>
<div class="section" id="id9">
<h4>events<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><strong>onManage</strong>, overloading this method allows to get an inside handle every two seconds (see <a class="reference internal" href="serverapp.html#ref-com-server-client"><span class="std std-ref">Communication between server and client</span></a> to get a sample usage).</li>
</ul>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last"><em>onManage</em> event doesn&#8217;t work for the main writer of one client, but just for a writer created by script code with <em>newWriter()</em> method (see methods description above).</p>
</div>
</div>
</div>
<div class="section" id="groups">
<span id="ref-groups"></span><h3><a class="toc-backref" href="#id41">Groups</a><a class="headerlink" href="#groups" title="Permalink to this headline">¶</a></h3>
<p>Existing groups (<a class="reference external" href="http://help.adobe.com/en_US/FlashPlatform/reference/actionscript/3/flash/net/NetGroup.html">NetGroup</a> running), see <a class="reference internal" href="#group">Group</a> object.
<em>groups</em> object (available by <em>mona.groups</em> way, see above) is the collection of groups currently running on the server. It means all <a class="reference external" href="http://help.adobe.com/en_US/FlashPlatform/reference/actionscript/3/flash/net/NetGroup.html">NetGroup</a> created or joined by clients.</p>
<div class="section" id="id10">
<h4>methods<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><strong>(id/rawId)</strong>, return a <a class="reference internal" href="#group">Group</a> object, it can take the id group parameter in a <em>string</em> format or a <em>raw hex</em> format (see <a class="reference internal" href="#group">Group</a> object).</li>
<li><strong>join(peerId,groupId)</strong>, add the <em>peerId</em> in the group <em>groupId</em>. This feature acts on the <a class="reference external" href="http://help.adobe.com/en_US/FlashPlatform/reference/actionscript/3/flash/net/NetGroup.html">NetGroup</a> members exchange (rendezvous service), it doesn&#8217;t add the client with for id <em>peerId</em> in the group, it adds the <em>peerId</em> value as a <em>virtual member</em> of the group. For this reason, you have to be sure that this peer exists somewhere and has joined this group. Indeed, it&#8217;s used just in multiple-servers case (see <a class="reference internal" href="scalability.html"><span class="doc">Scalability and load-balancing</span></a> page). On success it returns a <a class="reference internal" href="#member">Member</a> object related.</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>You can use the <strong>pairs()</strong> <a class="reference external" href="http://www.lua.org/">LUA</a> function to iterate on the list of <a class="reference internal" href="#groups">Groups</a>, keys are <em>group.id</em> and values are <a class="reference internal" href="#group">Group</a> objects.</li>
<li>And the &#8220;#&#8221; operator to get the number of groups.</li>
</ul>
</div>
</div>
</div>
<div class="section" id="group">
<h3><a class="toc-backref" href="#id42">Group</a><a class="headerlink" href="#group" title="Permalink to this headline">¶</a></h3>
<p><em>group</em> object describes a group instance (<a class="reference external" href="http://help.adobe.com/en_US/FlashPlatform/reference/actionscript/3/flash/net/NetGroup.html">NetGroup</a> instance).</p>
<div class="section" id="id11">
<h4>properties<a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><strong>id</strong> (read-only), the group id in a readable string format, it has a size of 64 bytes.</li>
<li><strong>rawId</strong> (read-only), the group id in a hexadecimal raw format, it has a size of 32 bytes.</li>
<li><strong>members</strong> (read-only), the list of <a class="reference internal" href="#clients">Clients</a> in the group.</li>
</ul>
</div>
<div class="section" id="id12">
<h4>methods<a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><strong>size()</strong>, return the number of client of the group.</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>You can use the <strong>pairs()</strong> <a class="reference external" href="http://www.lua.org/">LUA</a> function to iterate on the list of <em>members</em>.</li>
</ul>
</div>
</div>
</div>
<div class="section" id="member">
<h3><a class="toc-backref" href="#id43">Member</a><a class="headerlink" href="#member" title="Permalink to this headline">¶</a></h3>
<p><em>member</em> object is a virtual member of one group, gotten by a <em>groups:join(peerId,joinId)</em> call (see <a class="reference internal" href="#groups">Groups</a> object). It&#8217;s here just to allow to detach this virtual member of its group. It&#8217;s done on its destruction by the <a class="reference external" href="http://www.lua.org/">LUA</a> garbage collector, or when wanted in calling its <em>release()</em> method.</p>
<div class="section" id="id13">
<h4>properties<a class="headerlink" href="#id13" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><strong>id</strong> (read-only), the peer id in a readable string format, it has a size of 64 bytes.</li>
<li><strong>rawId</strong> (read-only), the peer id in a hexadecimal raw format, it has a size of 32 bytes.</li>
</ul>
</div>
<div class="section" id="id14">
<h4>methods<a class="headerlink" href="#id14" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><strong>release()</strong>, unjoin its group, its existence has no more meaning.</li>
</ul>
</div>
</div>
<div class="section" id="qualityofservice">
<h3><a class="toc-backref" href="#id44">QualityOfService</a><a class="headerlink" href="#qualityofservice" title="Permalink to this headline">¶</a></h3>
<p><em>qualityOfService</em> object describes describes how are going a publication or a subscription (see <a class="reference internal" href="#publication">Publication</a> and <a class="reference internal" href="#listener">Listener</a> objects).</p>
<div class="section" id="id15">
<h4>properties<a class="headerlink" href="#id15" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><strong>lostRate</strong> (read-only), value between 0 and 1 to indicate the lost data rate.</li>
<li><strong>byteRate</strong> (read-only), byte rate (bytes per second).</li>
<li><strong>latency</strong> (read-only), delay in milliseconds between data sending and receiving.</li>
<li><strong>lastSendingTime</strong> (read-only), last time a frame has been sent.</li>
</ul>
</div>
</div>
<div class="section" id="publications">
<h3><a class="toc-backref" href="#id45">Publications</a><a class="headerlink" href="#publications" title="Permalink to this headline">¶</a></h3>
<p><em>publications</em> object (available by <em>mona.publications</em> way, see <a class="reference internal" href="#mona">Mona</a> object) is the collection of publications actually publishing on the server.</p>
<div class="section" id="id16">
<h4>methods<a class="headerlink" href="#id16" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><strong>(name)</strong>, return a <a class="reference internal" href="#publication">Publication</a> object, it can take the name of the <a class="reference internal" href="#publication">Publication</a> in argument.</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>You can use the <strong>pairs()</strong> <a class="reference external" href="http://www.lua.org/">LUA</a> function to iterate on the list of <a class="reference internal" href="#publications">Publications</a>, keys are <em>publication.name</em> and values are <a class="reference internal" href="#publication">Publication</a> object.</li>
<li>And the &#8220;#&#8221; operator to get the number of publications.</li>
</ul>
</div>
</div>
</div>
<div class="section" id="publication">
<h3><a class="toc-backref" href="#id46">Publication</a><a class="headerlink" href="#publication" title="Permalink to this headline">¶</a></h3>
<p><em>publication</em> object describes a publication.</p>
<div class="section" id="id17">
<h4>properties<a class="headerlink" href="#id17" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><strong>name</strong> (read-only), name of the publication</li>
<li><strong>lastTime</strong> (read-only), returns the last media time published.</li>
<li><strong>droppedFrames</strong> (read-only), return the number of dropped video frames till the publication is alive. Frames are dropped when at least one fragment is lost.</li>
<li><strong>listeners</strong> (read-only), <a class="reference internal" href="#listeners">Listeners</a> which have subscribed for this publication.</li>
<li><strong>audioQOS</strong> (read-only), <a class="reference internal" href="#qualityofservice">QualityOfService</a> object about audio transfer for this publication.</li>
<li><strong>videoQOS</strong> (read-only), <a class="reference internal" href="#qualityofservice">QualityOfService</a> object about video transfer for this publication.</li>
<li><strong>dataQOS</strong> (read-only), <a class="reference internal" href="#qualityofservice">QualityOfService</a> object about data transfer for this publication.</li>
<li><strong>running</strong> (read-only), true if the publication is running.</li>
<li><strong>properties</strong> (read-only), returns publication properties (metadata).</li>
</ul>
</div>
<div class="section" id="id18">
<h4>methods<a class="headerlink" href="#id18" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><strong>writeProperties(properties)</strong>, set publication properties (write metadata).</li>
<li><strong>clearProperties()</strong>, clear publication properties (clear metadata).</li>
<li><strong>pushAudio(time,packet[,ping])</strong>, push audio data to this publication. First argument is the time in milliseconds of this audio sample in the stream, the second argument is the packet data. And the last optional argument is to increment the latency counter (it&#8217;s used by <a class="reference internal" href="#qualityofservice">QualityOfService</a> object).</li>
<li><strong>pushVideo(time,packet[,ping])</strong>, push video data to this publication. First argument is the time in milliseconds of this video frame in the stream, the second argument is the packet data. And the last optional argument is to increment the latency counter (it&#8217;s used by <a class="reference internal" href="#qualityofservice">QualityOfService</a> object).</li>
<li><strong>pushAMFData(...)</strong>, push data to this publication. The arguments passed are serialized in AMF.</li>
<li><strong>pushAMF0Data(...)</strong>, push data to this publication. The arguments passed are serialized in AMF0.</li>
<li><strong>pushXMLRPCData(...)</strong>, push data to this publication. The arguments passed are serialized in XMLRPC.</li>
<li><strong>pushJSONData(...)</strong>, push data to this publication. The arguments passed are serialized in JSON.</li>
<li><strong>pushData(...)</strong>, push data to this publication. The arguments passed are just raw concatenated (no typed serialization).</li>
<li><strong>flush()</strong>, when you push audio, video or data packets, they are not flushed to listeners, you have to call this method to broadcast data when you have finished of pushed all available packets.</li>
<li><strong>close([code,description])</strong>, close a publication. If this publication had been published with <em>mona.publish</em> function (see <a class="reference internal" href="#mona">Mona</a> object), the publication will be unpublished and deleted, and optional arguments are useless. Now if it&#8217;s a client publication, its method <em>close</em> will be invoked, and a status event will be sent if optional arguments are indicated. For example, <em>publication:close(&#8216;Publish.Error&#8217;,&#8217;error message&#8217;)</em> will send a <em>NetStream.Publish.Error</em> statut event with as description <em>error message</em>, and then will invoke <em>close</em> method on client side for the <em>NetStream</em> object related.</li>
</ul>
</div>
<div class="section" id="id19">
<h4>events<a class="headerlink" href="#id19" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><strong>onVideo(time,packet)</strong>, call on video packet reception for one <a class="reference internal" href="#publication">Publication</a>. <em>time</em> is the time in milliseconds of this packet in the stream, and <em>packet</em> contains video data.</li>
<li><strong>onAudio(time,packet)</strong>, call on audio packet reception for one <a class="reference internal" href="#publication">Publication</a>. <em>time</em> is the time in milliseconds of this packet in the stream, and <em>packet</em> contains video data.</li>
<li><strong>onData(packet)</strong>, call on data packet reception for one <a class="reference internal" href="#publication">Publication</a>. <em>packet</em> contains raw data.</li>
<li><strong>onFlush()</strong>, call on publication flush.</li>
</ul>
</div>
</div>
<div class="section" id="listeners">
<h3><a class="toc-backref" href="#id47">Listeners</a><a class="headerlink" href="#listeners" title="Permalink to this headline">¶</a></h3>
<p><em>listeners</em> object describes a collection of subscribers for one <a class="reference internal" href="#publication">Publication</a>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>You can use the <strong>pairs()</strong> <a class="reference external" href="http://www.lua.org/">LUA</a> function to iterate on the list of <a class="reference internal" href="#listener">Listener</a>, keys are <a class="reference internal" href="#client">Client</a> objects and values are <a class="reference internal" href="#listener">Listener</a> objects.</li>
<li>And the &#8220;#&#8221; operator to get the number of listeners.</li>
</ul>
</div>
</div>
<div class="section" id="listener">
<h3><a class="toc-backref" href="#id48">Listener</a><a class="headerlink" href="#listener" title="Permalink to this headline">¶</a></h3>
<p><em>listener</em> object describes a subscriber for one publication.</p>
<div class="section" id="id20">
<h4>properties<a class="headerlink" href="#id20" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><strong>client</strong> (read-only), refers to the <a class="reference internal" href="#client">Client</a> object which is listening.</li>
<li><strong>audioQOS</strong> (read-only), <a class="reference internal" href="#qualityofservice">QualityOfService</a> object about audio transfer for this subscription.</li>
<li><strong>videoQOS</strong> (read-only), <a class="reference internal" href="#qualityofservice">QualityOfService</a> object about video transfer for this subscription.</li>
<li><strong>dataQOS</strong> (read-only), <a class="reference internal" href="#qualityofservice">QualityOfService</a> object about data transfer for this subscription.</li>
<li><strong>publication</strong> (read-only), <a class="reference internal" href="#publication">Publication</a> object which describes publication listening by the subscriber.</li>
<li><strong>receiveAudio</strong>, boolean to mute audio reception on the subscription.</li>
<li><strong>receiveVideo</strong>, boolean to mute video reception on the subscription.</li>
</ul>
</div>
</div>
<div class="section" id="bytereader">
<h3><a class="toc-backref" href="#id49">ByteReader</a><a class="headerlink" href="#bytereader" title="Permalink to this headline">¶</a></h3>
<p>This object is only used for IExternalizable typed object, it&#8217;s the first argument of <em>__readExternal</em> function, and it&#8217;s an equivalent for <a class="reference external" href="http://help.adobe.com/en_US/FlashPlatform/reference/actionscript/3/flash/utils/IDataInput.html">IDataInput</a> AS3 class (see <a class="reference internal" href="serverapp.html#ref-amf-to-lua"><span class="std std-ref">AMF to LUA conversions</span></a> to know how AMF/<a class="reference external" href="http://www.lua.org/">LUA</a> conversion works). It contains exactly same functions, excepting <em>readObject()</em> which is replaced by <em>readAMF(x)</em> function. <em>readAMF(x)</em> returns the <em>x</em> first <a class="reference external" href="http://www.lua.org/">LUA</a> results which come from the AMF unserialization.</p>
</div>
<div class="section" id="bytewriter">
<h3><a class="toc-backref" href="#id50">ByteWriter</a><a class="headerlink" href="#bytewriter" title="Permalink to this headline">¶</a></h3>
<p>This object is only used for IExternalizable typed object, it&#8217;s the first argument of <em>__writeExternal</em> function, and it&#8217;s an equivalent for <a class="reference external" href="http://help.adobe.com/en_US/FlashPlatform/reference/actionscript/3/flash/utils/IDataOutput.html">IDataOutput</a> AS3 class (see <a class="reference internal" href="serverapp.html#ref-amf-to-lua"><span class="std std-ref">AMF to LUA conversions</span></a> to know how AMF/<a class="reference external" href="http://www.lua.org/">LUA</a> conversion works). It contains exactly same functions, excepting _writeObject(object:*) which is replaced by <em>writeAMF(...)</em> function. <em>writeAMF(...)</em> takes multiple <a class="reference external" href="http://www.lua.org/">LUA</a> arguments for AMF serialization.</p>
</div>
<div class="section" id="servers">
<h3><a class="toc-backref" href="#id51">Servers</a><a class="headerlink" href="#servers" title="Permalink to this headline">¶</a></h3>
<p>Servers list of MonaServer currently connected to the server (see <a class="reference internal" href="scalability.html"><span class="doc">Scalability and load-balancing</span></a> page for more details about multiple server features).</p>
<div class="section" id="id21">
<h4>properties<a class="headerlink" href="#id21" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><strong>initiators</strong> (read-only), return a <a class="reference internal" href="#broadcaster">Broadcaster</a> object including the server initiators. Server connections have a direction, with an iniator of the connection, and a target of the connection (see <a class="reference internal" href="scalability.html"><span class="doc">Scalability and load-balancing</span></a> page for more details).</li>
<li><strong>targets</strong> (read-only), return a <a class="reference internal" href="#broadcaster">Broadcaster</a> object including the server targets. Server connections have a direction, with an iniator of the connection, and a target of the connection (see <a class="reference internal" href="scalability.html"><span class="doc">Scalability and load-balancing</span></a> page for more details).</li>
</ul>
</div>
<div class="section" id="id22">
<h4>methods<a class="headerlink" href="#id22" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><strong>broadcast(handler,...)</strong>, broadcast data to servers (initiators and targets). The <em>handler</em> parameter is the name of the <em>remote procedure call</em> method to receive data, multiple arguments following are the data (see <a class="reference internal" href="scalability.html"><span class="doc">Scalability and load-balancing</span></a> page for more details).</li>
<li><strong>(address/index)</strong>, return a <a class="reference internal" href="#server">Server</a> object. It can take the <em>address</em> of the server (string format) or the <em>index</em> of server (number format) as input argument. Indeed the list is sorted by order of connections.</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>You can use the <strong>ipairs()</strong> <a class="reference external" href="http://www.lua.org/">LUA</a> function to iterate on the list of servers.</li>
<li>And the &#8220;#&#8221; operator to get the number of servers.</li>
</ul>
</div>
</div>
</div>
<div class="section" id="server">
<span id="ref-server"></span><h3><a class="toc-backref" href="#id52">Server</a><a class="headerlink" href="#server" title="Permalink to this headline">¶</a></h3>
<p><em>server</em> object describes a server communication (see <a class="reference internal" href="scalability.html"><span class="doc">Scalability and load-balancing</span></a> page for more details about multiple server features).</p>
<div class="section" id="id23">
<h4>properties<a class="headerlink" href="#id23" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><strong>address</strong> (read-only), object address of the server.</li>
<li><strong>host</strong> (read-only), hostname of the server.</li>
<li><strong>port</strong> (read-only), port used for the server-to-server connection.</li>
<li><strong>isTarget</strong> (read-only), true if the server is a target of current server.</li>
<li><strong>configs</strong> (read-only), configuration properties of the server (see <a class="reference internal" href="installation.html#ref-configurations"><span class="std std-ref">Configurations</span></a>).</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><em>server</em> object can have other dynamic properties (as <a class="reference internal" href="#client">Client</a> object) which relates properties used during the server connection (see <a class="reference internal" href="installation.html#ref-configurations"><span class="std std-ref">Configurations</span></a>).</p>
</div>
</div>
<div class="section" id="id24">
<h4>methods<a class="headerlink" href="#id24" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><strong>send(handler[,parameters])</strong>, call a method of the server.</li>
<li><strong>reject([message])</strong>, disconnect from the server.</li>
</ul>
<p>You can add some methods into a <strong>Server</strong> object to create RPC functions availables from other servers (see <a class="reference internal" href="scalability.html"><span class="doc">Scalability and load-balancing</span></a> page for more details).</p>
</div>
</div>
<div class="section" id="broadcaster">
<h3><a class="toc-backref" href="#id53">Broadcaster</a><a class="headerlink" href="#broadcaster" title="Permalink to this headline">¶</a></h3>
<p>Allow to manipulate list of server initiators or targets gotten with <em>servers.initiators</em> or <em>servers.targets</em> (see <a class="reference internal" href="#servers">Servers</a> object).</p>
<div class="section" id="id25">
<h4>properties<a class="headerlink" href="#id25" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><strong>count</strong> (read-only), number of servers.</li>
</ul>
</div>
<div class="section" id="id26">
<h4>methods<a class="headerlink" href="#id26" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><strong>broadcast(handler,...)</strong>, broadcast data to servers. The <em>handler</em> parameter is the name of the <em>remote procedure call</em> method to receive data, multiple arguments following are the data (see <a class="reference internal" href="scalability.html"><span class="doc">Scalability and load-balancing</span></a> page for more details).</li>
<li><strong>(address/index)</strong>, return a <a class="reference internal" href="#server">Server</a> object. It can take the <em>address</em> of the server (string format) or the <em>index</em> of server (number format) as input argument. Indeed the list is sorted by order of connections.</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You can use the <strong>ipairs()</strong> <a class="reference external" href="http://www.lua.org/">LUA</a> function to iterate on the list of servers.</p>
</div>
</div>
</div>
<div class="section" id="file">
<h3><a class="toc-backref" href="#id54">File</a><a class="headerlink" href="#file" title="Permalink to this headline">¶</a></h3>
<p><em>File</em> object gives some properties of a file in the file system. <em>File</em> objects are created on a <em>mona:listPaths(...)</em> call (see <a class="reference internal" href="#mona">Mona</a> object).</p>
<div class="section" id="id27">
<h4>properties<a class="headerlink" href="#id27" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><strong>name</strong> (read-only), name of the file</li>
<li><strong>baseName</strong> (read-only), name of the file, without extension</li>
<li><strong>parent</strong> (read-only), name of the parent directory</li>
<li><strong>extension</strong> (read-only), extension of the file</li>
<li><strong>size</strong> (read-only), size of the file</li>
<li><strong>lastModified</strong> (read-only), date of last modification (in seconds)</li>
<li><strong>isFolder</strong> (read-only), true if the file is a directory</li>
<li><strong>value</strong> (read-only), full path of the file</li>
</ul>
</div>
</div>
<div class="section" id="ipaddress">
<h3><a class="toc-backref" href="#id55">IPAddress</a><a class="headerlink" href="#ipaddress" title="Permalink to this headline">¶</a></h3>
<p><em>IPAddress</em> object gives the properties of an IP address. <em>IPAddress</em> objects are created on a <em>mona:createIPAddress(...)</em> or <em>mona:createIPAddressWithDNS(...)</em> call (see <a class="reference internal" href="#mona">Mona</a> object).</p>
<div class="section" id="id28">
<h4>properties<a class="headerlink" href="#id28" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><strong>isWildcard</strong> (read-only), true if this address is the wildcard address (all zero)</li>
<li><strong>isBroadcast</strong> (read-only), true if this address is the local network broadcast address (255.255.255.255, only IPv4 addresses can be broadcast addresses)</li>
<li><strong>isAnyBroadcast</strong> (read-only), true if this address is a broadcast address (only IPv4 addresses can be broadcast addresses)</li>
<li><strong>isLoopback</strong> (read-only), true if this address is a loopback address</li>
<li><strong>isMulticast</strong> (read-only), true if this address is a multicast address (224.0.0.0 to 239.255.255.255 for IPv4, FFxx:x:x:x:x:x:x:x range for IPv6)</li>
<li><strong>isUnicast</strong> (read-only), true if this address is a unicast address (if it is neither a wildcard, broadcast or multicast address)</li>
<li><strong>isLinkLocal</strong> (read-only), true if this address is a link local unicast address (169.254.0.0/16 range for IPv4, FE80:: for IPv6)</li>
<li><strong>isSiteLocal</strong> (read-only), true if this address is a a site local unicast address (10.0.0.0/24, 192.168.0.0/16 or 172.16.0.0 to 172.31.255.255 ranges for IPv4, FEC0:: for IPv6</li>
<li><strong>isIPv4Compatible</strong> (read-only), true if this address is IPv4 compatible (for IPv6 the address must be in the ::x:x range)</li>
<li><strong>isIPv4Mapped</strong> (read-only), true if this address is an IPv4 mapped IPv6 address (For IPv6, the address must be in the ::FFFF:x:x range)</li>
<li><strong>isWellKnownMC</strong> (read-only), true if this address is a well-known multicast address (224.0.0.0/8 range for IPv4, FF0x:x:x:x:x:x:x:x range for IPv6)</li>
<li><strong>isNodeLocalMC</strong> (read-only), true if this address is a node-local multicast address (always false for IPv4, in the FFx1:x:x:x:x:x:x:x range for IPv6)</li>
<li><strong>isLinkLocalMC</strong> (read-only), true if this address is a link-local multicast address (224.0.0.0/24 range for IPv4, FFx2:x:x:x:x:x:x:x range for IPv6)</li>
<li><strong>isSiteLocalMC</strong> (read-only), true if this address is a site-local multicast address (239.255.0.0/16 range for IPv4, FFx5:x:x:x:x:x:x:x for IPv6)</li>
<li><strong>isOrgLocalMC</strong> (read-only), true if this address is an organization-local multicast address (239.192.0.0/16 range for IPv4, FFx8:x:x:x:x:x:x:x range for IPv6)</li>
<li><strong>isGlobalMC</strong> (read-only), true if this address is a global multicast address (224.0.1.0 to 238.255.255.255 range for IPv4, FFxF:x:x:x:x:x:x:x range for IPv6)</li>
<li><strong>isLocal</strong> (read-only), true if this address is local</li>
<li><strong>isIPv6</strong> (read-only), true if this address is a IPv6 address</li>
<li><strong>value</strong> (read-only), the string representation of the address</li>
</ul>
</div>
</div>
<div class="section" id="socketaddress">
<h3><a class="toc-backref" href="#id56">SocketAddress</a><a class="headerlink" href="#socketaddress" title="Permalink to this headline">¶</a></h3>
<p><em>SocketAddress</em> object represents a pair <em>host:port</em> of a socket connection. <em>SocketAddress</em> objects are created on a <em>mona:createSocketAddress(...)</em> or <em>mona:createSocketAddressWithDNS(...)</em> call (see <a class="reference internal" href="#mona">Mona</a> object).</p>
<div class="section" id="id29">
<h4>properties<a class="headerlink" href="#id29" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><strong>host</strong> (read-only), the <a class="reference internal" href="#ipaddress">IPAddress</a> object of this socket address</li>
<li><strong>port</strong> (read-only), the port of the socket address</li>
<li><strong>isIPv6</strong> (read-only), true if the host is an IPv6 address</li>
<li><strong>value</strong> (read-only), the string representation of the socket address (<em>host:port</em>)</li>
</ul>
</div>
</div>
</div>
<div class="section" id="ref-events">
<span id="id30"></span><h2><a class="toc-backref" href="#id57">Events</a><a class="headerlink" href="#ref-events" title="Permalink to this headline">¶</a></h2>
<p>MonaServer calls some events in application server script.</p>
<div class="section" id="id31">
<h3><a class="toc-backref" href="#id58">Common notions</a><a class="headerlink" href="#id31" title="Permalink to this headline">¶</a></h3>
<p>All event names starts with the <em>on</em> prefix.</p>
<div class="highlight-lua"><div class="highlight"><pre><span></span><span class="k">function</span> <span class="nf">onConnection</span><span class="p">(</span><span class="n">client</span><span class="p">,</span><span class="o">...</span><span class="p">)</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="section" id="onstart-path">
<h3><a class="toc-backref" href="#id59">onStart(path)</a><a class="headerlink" href="#onstart-path" title="Permalink to this headline">¶</a></h3>
<p>Called when the server application is built and executed the first time. The first argument is the <em>path</em> of the application (see <a class="reference internal" href="serverapp.html#ref-create-server-app"><span class="std std-ref">Create a server application</span></a>).</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">All server application are built on first client connection for the application, except <em>root</em> application (<em>/</em> application), which is started on MonaServer starting.</p>
</div>
</div>
<div class="section" id="onstop-path">
<h3><a class="toc-backref" href="#id60">onStop(path)</a><a class="headerlink" href="#onstop-path" title="Permalink to this headline">¶</a></h3>
<p>Called when the server application is unloaded. It happens in three different cases:</p>
<ul class="simple">
<li>When you edit <em>main.lua</em> file of one server application. Application is restarted (stopped and started).</li>
<li>When you delete a server application.</li>
<li>When MonaServer is stopping.</li>
</ul>
<p>The first argument is the <em>path</em> of the application (see <a class="reference internal" href="serverapp.html#ref-create-server-app"><span class="std std-ref">Create a server application</span></a>).</p>
</div>
<div class="section" id="onconnection-client">
<h3><a class="toc-backref" href="#id61">onConnection(client,...)</a><a class="headerlink" href="#onconnection-client" title="Permalink to this headline">¶</a></h3>
<p>Called on a new client connection. First argument is a <a class="reference internal" href="#client">Client</a> object, and following arguments depend on the protocol (see <a class="reference internal" href="protocols.html"><span class="doc">Specific Protocol Features</span></a>).</p>
<p>Finally you can return a table result to send some informations on RTMP&amp;RTMFP connections (see <a class="reference internal" href="protocols.html"><span class="doc">Specific Protocol Features</span></a>) or to overload some configuration parameters:</p>
<ul class="simple">
<li><strong>timeout</strong> , timeout in seconds. It overloads the timeout parameter from the configuration file (see <a class="reference internal" href="installation.html"><span class="doc">Installation</span></a>).</li>
</ul>
<div class="highlight-lua"><div class="highlight"><pre><span></span><span class="k">function</span> <span class="nf">onConnection</span><span class="p">(</span><span class="n">client</span><span class="p">,</span><span class="o">...</span><span class="p">)</span>
  <span class="k">return</span> <span class="p">{</span><span class="n">message</span><span class="o">=</span><span class="s2">&quot;</span><span class="s">welcome&quot;</span><span class="p">,</span><span class="n">id</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">timeout</span><span class="o">=</span><span class="mi">7</span><span class="p">}</span>
<span class="k">end</span>
</pre></div>
</div>
<p>The as3 code below illustrates the returned parameters on RTMP&amp;RTMFP connections:</p>
<div class="highlight-as3"><div class="highlight"><pre><span></span><span class="kd">function </span><span class="nf">onStatusEvent</span><span class="o">(</span><span class="n">event</span><span class="o">:</span><span class="kt">NetStatusEvent</span><span class="o">):</span><span class="kt">void</span> <span class="o">{</span>
  <span class="k">switch</span><span class="o">(</span><span class="n">event</span><span class="o">.</span><span class="na">info</span><span class="o">.</span><span class="na">code</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">case</span> <span class="s2">&quot;NetConnection.Connect.Success&quot;</span><span class="o">:</span>
    <span class="nf">trace</span><span class="o">(</span><span class="n">event</span><span class="o">.</span><span class="na">info</span><span class="o">.</span><span class="na">message</span><span class="o">);</span> <span class="c1">// displays &quot;welcome&quot;</span>
    <span class="nf">trace</span><span class="o">(</span><span class="n">event</span><span class="o">.</span><span class="na">info</span><span class="o">.</span><span class="na">id</span><span class="o">);</span> <span class="c1">// displays &quot;1&quot;</span>
    <span class="k">break</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<p>You can reject a client by adding an error of connection:</p>
<div class="highlight-lua"><div class="highlight"><pre><span></span><span class="k">function</span> <span class="nf">onConnection</span><span class="p">(</span><span class="n">client</span><span class="p">,</span><span class="n">login</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">login</span> <span class="o">~=</span> <span class="s2">&quot;</span><span class="s">Tom&quot;</span> <span class="k">then</span>
    <span class="nb">error</span><span class="p">(</span><span class="s2">&quot;</span><span class="s">you are not Tom!&quot;</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
<div class="highlight-as3"><div class="highlight"><pre><span></span><span class="n">_netConnection</span><span class="o">.</span><span class="na">connect</span><span class="o">(</span><span class="s2">&quot;rtmfp://localhost/&quot;</span><span class="o">,</span><span class="s2">&quot;Ben&quot;</span><span class="o">)</span>

<span class="kd">function </span><span class="nf">onStatusEvent</span><span class="o">(</span><span class="n">event</span><span class="o">:</span><span class="kt">NetStatusEvent</span><span class="o">):</span><span class="kt">void</span> <span class="o">{</span>
  <span class="k">switch</span><span class="o">(</span><span class="n">event</span><span class="o">.</span><span class="na">info</span><span class="o">.</span><span class="na">code</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">case</span> <span class="s2">&quot;NetConnection.Connect.Rejected&quot;</span><span class="o">:</span>
    <span class="nf">trace</span><span class="o">(</span><span class="n">event</span><span class="o">.</span><span class="na">info</span><span class="o">.</span><span class="na">description</span><span class="o">);</span> <span class="c1">// displays &quot;you are not Tom!&quot;</span>
    <span class="k">break</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<p>In RTMP&amp;RTFMP it answers with a <em>NetConnection.Connect.Rejected</em> status event and close the client connection. The <em>event.info.description</em> field contains your error message. Now if you reject a client with no error message, <em>event.info.description</em> field will contain &#8220;client rejected&#8221; by default.</p>
<p>You can subscribe for <a class="reference internal" href="#client">Client</a> events under the onConnection scope like in this sample :</p>
<div class="highlight-lua"><div class="highlight"><pre><span></span><span class="k">function</span> <span class="nf">onConnection</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>

  <span class="k">function</span> <span class="nf">client</span><span class="p">:</span><span class="n">onMessage</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
    <span class="n">NOTE</span><span class="p">(</span><span class="n">client</span><span class="p">.</span><span class="n">address</span><span class="o">..</span><span class="s2">&quot;</span><span class="s"> says &quot;</span><span class="o">..</span><span class="n">message</span><span class="p">)</span>
  <span class="k">end</span>

<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="section" id="ondisconnection-client">
<h3><a class="toc-backref" href="#id62">onDisconnection(client)</a><a class="headerlink" href="#ondisconnection-client" title="Permalink to this headline">¶</a></h3>
<p>Call on <a class="reference internal" href="#client">Client</a> disconnection. <em>client</em> argument is the disconnected client.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">At this stage you can send no more data to the client, all writing to a <a class="reference internal" href="#writer">Writer</a> object of this client has no effect.</p>
</div>
</div>
<div class="section" id="onmanage">
<span id="ref-onmanage"></span><h3><a class="toc-backref" href="#id63">onManage()</a><a class="headerlink" href="#onmanage" title="Permalink to this headline">¶</a></h3>
<p>Call every two seconds, this event is available only in the <em>root</em> server application (<em>www/main.lua</em>). It allows easyly to get handle to manage your objects if need.</p>
</div>
<div class="section" id="onrendezvousunknown-protocol-peerid">
<span id="ref-onrendezvousunknown"></span><h3><a class="toc-backref" href="#id64">onRendezVousUnknown(protocol, peerId)</a><a class="headerlink" href="#onrendezvousunknown-protocol-peerid" title="Permalink to this headline">¶</a></h3>
<p>Allows to redirect a client who searchs a peerId that the rendezvous service doesn&#8217;t find. Usually you will redirect the client to one or multiple other MonaServer (see <a class="reference internal" href="scalability.html"><span class="doc">Scalability and load-balancing</span></a> for more details on multiple servers usage). You can return an address, but also multiple address, or an array of addresses.</p>
<div class="highlight-lua"><div class="highlight"><pre><span></span><span class="k">function</span> <span class="nf">onRendezVousUnknown</span><span class="p">(</span><span class="n">protocol</span><span class="p">,</span> <span class="n">peerId</span><span class="p">)</span>
  <span class="k">return</span> <span class="mf">192.168.0.2</span><span class="p">:</span><span class="mi">1935</span>
<span class="k">end</span>
</pre></div>
</div>
<div class="highlight-lua"><div class="highlight"><pre><span></span><span class="k">function</span> <span class="nf">onRendezVousUnknown</span><span class="p">(</span><span class="n">protocol</span><span class="p">,</span> <span class="n">peerId</span><span class="p">)</span>
  <span class="k">return</span> <span class="mf">192.168.0.2</span><span class="p">:</span><span class="mi">1935</span><span class="p">,</span><span class="mf">192.168.0.3</span><span class="p">:</span><span class="mi">1935</span>
<span class="k">end</span>
</pre></div>
</div>
<div class="highlight-lua"><div class="highlight"><pre><span></span><span class="n">addresses</span> <span class="o">=</span> <span class="p">{</span><span class="mf">192.168.0.2</span><span class="p">:</span><span class="mi">1936</span><span class="p">,</span><span class="mf">192.168.0.3</span><span class="p">:</span><span class="mi">1936</span><span class="p">}</span>
<span class="k">function</span> <span class="nf">onRendezVousUnknown</span><span class="p">(</span><span class="n">protocol</span><span class="p">,</span> <span class="n">peerId</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">addresses</span>
<span class="k">end</span>
</pre></div>
</div>
<p>Then you can return a <a class="reference internal" href="#server">Server</a> object or a <a class="reference internal" href="#servers">Servers</a> object:</p>
<div class="highlight-lua"><div class="highlight"><pre><span></span><span class="k">function</span> <span class="nf">onRendezVousUnknown</span><span class="p">(</span><span class="n">protocol</span><span class="p">,</span> <span class="n">peerId</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">mona</span><span class="p">.</span><span class="n">servers</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="c1">-- redirect to the first server connected</span>
<span class="k">end</span>
</pre></div>
</div>
<div class="highlight-lua"><div class="highlight"><pre><span></span><span class="k">function</span> <span class="nf">onRendezVousUnknown</span><span class="p">(</span><span class="n">protocol</span><span class="p">,</span> <span class="n">peerId</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">mona</span><span class="p">.</span><span class="n">servers</span> <span class="c1">-- redirect to all the connected servers</span>
<span class="k">end</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">When this function returns multiple addresses, the client will receive all these addresses and will start multiple attempt in parallel to these servers.</p>
</div>
</div>
<div class="section" id="onhandshake-address-path-properties-attempts">
<span id="ref-onhandshake"></span><h3><a class="toc-backref" href="#id65">onHandshake(address,path,properties,attempts)</a><a class="headerlink" href="#onhandshake-address-path-properties-attempts" title="Permalink to this headline">¶</a></h3>
<p>Allows to redirect the client to one other MonaServer (see <a class="reference internal" href="scalability.html"><span class="doc">Scalability and load-balancing</span></a> for more details on multiple servers usage), in returning address(es) of redirection. About the returned value it works exactly same the returned value of <a class="reference internal" href="#ref-onrendezvousunknown"><span class="std std-ref">onRendezVousUnknown(protocol, peerId)</span></a> event.
It&#8217;s called on the first packet received from one client (before the creation of its client object associated). First <em>address</em> argument is the address of the client, <em>path</em> argument indicates the path expression of connection, <em>properties</em> argument is a table with the HTTP parameters given in the URL of connection (see dynamic properties of <a class="reference internal" href="#client">Client</a> object description) and <em>attempts</em> argument indicates the number of attempts of connection (starts to 1 and is incremented on each attempt).</p>
<div class="highlight-as3"><div class="highlight"><pre><span></span><span class="n">_netConnection</span><span class="o">.</span><span class="na">connect</span><span class="o">(</span><span class="s2">&quot;rtmfp://localhost/myApplication?acceptableAttempts=2&quot;</span><span class="o">);</span>
</pre></div>
</div>
<div class="highlight-lua"><div class="highlight"><pre><span></span><span class="n">index</span><span class="o">=</span><span class="mi">0</span>
<span class="k">function</span> <span class="nf">onHandshake</span><span class="p">(</span><span class="n">address</span><span class="p">,</span><span class="n">path</span><span class="p">,</span><span class="n">properties</span><span class="p">,</span><span class="n">attempts</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">attempts</span> <span class="o">&gt;</span> <span class="n">properties</span><span class="p">.</span><span class="n">acceptableAttempts</span> <span class="k">then</span>
    <span class="c1">-- This time we return all server available,</span>
    <span class="c1">-- and it&#39;s the client who will test what is the server the faster with parallel connection</span>
    <span class="c1">-- (first which answers wins)</span>
    <span class="k">return</span> <span class="n">mona</span><span class="p">.</span><span class="n">servers</span>
  <span class="k">end</span>
  <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span>
  <span class="k">if</span> <span class="n">index</span> <span class="o">&gt;</span> <span class="n">mona</span><span class="p">.</span><span class="n">servers</span><span class="p">.</span><span class="n">count</span> <span class="k">then</span> <span class="n">index</span><span class="o">=</span><span class="mi">1</span> <span class="k">end</span> <span class="c1">-- not exceed the number of server available</span>
  <span class="k">return</span> <span class="n">mona</span><span class="p">.</span><span class="n">servers</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="c1">-- load-balacing system!</span>
<span class="k">end</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You can use the keyword <em>again</em> to request a new attempt on <em>myself</em> (if the other redirection doesn&#8217;t work).</p>
</div>
<div class="highlight-lua"><div class="highlight"><pre><span></span><span class="k">function</span> <span class="nf">onHandshake</span><span class="p">(</span><span class="n">address</span><span class="p">,</span><span class="n">path</span><span class="p">,</span><span class="n">properties</span><span class="p">,</span><span class="n">attempts</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">mona</span><span class="p">.</span><span class="n">servers</span><span class="p">,</span><span class="s2">&quot;</span><span class="s">again&quot;</span> <span class="c1">-- redirect to the other server and my myself</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="section" id="onserverconnection-server">
<h3><a class="toc-backref" href="#id66">onServerConnection(server)</a><a class="headerlink" href="#onserverconnection-server" title="Permalink to this headline">¶</a></h3>
<p>Call on server connection, see <a class="reference internal" href="scalability.html"><span class="doc">Scalability and load-balancing</span></a> for more details on multiple servers usage, or <a class="reference internal" href="#server">Server</a> object.</p>
</div>
<div class="section" id="onserverdisconnection-server">
<h3><a class="toc-backref" href="#id67">onServerDisconnection(server)</a><a class="headerlink" href="#onserverdisconnection-server" title="Permalink to this headline">¶</a></h3>
<p>Call on server disconnection, see <a class="reference internal" href="scalability.html"><span class="doc">Scalability and load-balancing</span></a> for more details on multiple servers usage, or <a class="reference internal" href="#server">Server</a> object.</p>
</div>
</div>
</div>


    </div>
    
    <div class="col-md-12">
    
    
        <p></p>
    </div>

  </div>
</div>

    
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2015, Mathieu Poux &amp; Thomas Jammet.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.4.5.<br/>
    </p>
  </div>
</footer>
    </div>

  </body>
</html>